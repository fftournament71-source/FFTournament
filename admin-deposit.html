<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Admin Deposit Requests</title>

<style>
body{
    font-family: Arial;
    background:#f2f2f2;
    padding:20px;
}
.req{
    background:#fff;
    padding:15px;
    border-radius:10px;
    margin-bottom:12px;
    box-shadow:0 3px 10px rgba(0,0,0,0.1);
}
button{
    padding:8px 12px;
    border:none;
    border-radius:5px;
    color:#fff;
    font-weight:bold;
    cursor:pointer;
    margin-right:5px;
}
.ok{background:green}
.no{background:red}
</style>
</head>

<body>

<h2>üí∞ Deposit Requests (Admin)</h2>
<div id="list">Loading...</div>

<!-- üî• Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* üî¥ Firebase Config (‡¶®‡¶ø‡¶ú‡ßá‡¶∞‡¶ü‡¶æ ‡¶¨‡¶∏‡¶æ‡¶¨‡ßá) */
var firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
</script>

<script>
const list = document.getElementById("list");

/* LOAD REQUESTS */
firebase.database().ref("depositRequests").on("value", snap => {
    list.innerHTML = "";

    if (!snap.exists()) {
        list.innerHTML = "<p>No deposit requests</p>";
        return;
    }

    snap.forEach(child => {
        let r = child.val();
        let key = child.key;

        list.innerHTML += `
        <div class="req">
            <b>User:</b> ${r.email}<br>
            <b>Amount:</b> ${r.amount} TK<br>
            <b>Method:</b> ${r.method}<br>
            <b>Sender:</b> ${r.senderNumber}<br>
            <b>TXID:</b> ${r.txid}<br>
            <b>Status:</b> ${r.status}<br><br>

            <button class="ok" onclick="approve('${key}', '${r.email}', ${r.amount})">Approve</button>
            <button class="no" onclick="reject('${key}')">Reject</button>
        </div>
        `;
    });
});

/* APPROVE */
function approve(key, email, amount) {

    // USER BALANCE UPDATE
    firebase.database().ref("users").once("value", snap => {
        snap.forEach(child => {
            let user = child.val();
            if (user.email === email) {
                let newBal = (user.balance || 0) + amount;
                firebase.database().ref("users/" + child.key + "/balance").set(newBal);
            }
        });
    });

    // DELETE REQUEST
    firebase.database().ref("depositRequests/" + key).remove();

    alert("‚úÖ Deposit Approved!");
}

/* REJECT */
function reject(key) {
    firebase.database().ref("depositRequests/" + key).remove();
    alert("‚ùå Deposit Rejected!");
}
</script>

</body>
</html>
